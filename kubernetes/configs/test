#!/bin/bash

# Functions
# TODO Take version from image label
shortVersion() {
  echo $1 | grep -oE '[0-9]+\.[0-9]+'
}

# Services Versions
AGREEMENT_MANAGEMENT_IMAGE_VERSION="v0.1.1-snapshot"
ATTRIBUTE_REGISTRY_MANAGEMENT_IMAGE_VERSION="v0.1.1-snapshot"
AUTHORIZATION_MANAGEMENT_IMAGE_VERSION="v0.1.1-snapshot"
AUTHORIZATION_PROCESS_IMAGE_VERSION="v0.1.1-snapshot"
CATALOG_MANAGEMENT_IMAGE_VERSION="v0.1.1-snapshot"
CATALOG_PROCESS_IMAGE_VERSION="v0.1.1-snapshot"
ESERVICE_MOCKUP_IMAGE_VERSION="v0.1.1-snapshot"
KEY_MANAGEMENT_IMAGE_VERSION="v0.1.1-snapshot"
PARTY_MANAGEMENT_IMAGE_VERSION="v0.1.1-snapshot"
PARTY_MOCK_REGISTRY_IMAGE_VERSION="v0.1.1-snapshot"
PARTY_PROCESS_REVIEWS_IMAGE_VERSION="v0.1.1-snapshot"
PARTY_REGISTRY_PROXY_IMAGE_VERSION="v0.1.1-snapshot"
USER_REGISTRY_MANAGEMENT_IMAGE_VERSION="v0.1.1-snapshot"

# SPID_LOGIN_MODULE_IMAGE_VERSION="1.5.1-release"
SPID_LOGIN_MODULE_IMAGE_VERSION="2.1.1-10.24.1-alpine3.11"

# Common
NAMESPACE=$NAMESPACE
INTERNAL_INGRESS_HOST="gateway-private.test.pdnd-interop.pagopa.it"
EXTERNAL_INGRESS_HOST="gateway.test.pdnd-interop.pagopa.it"
INTERNAL_INGRESS_CLASS="nginx-internal"
EXTERNAL_INGRESS_CLASS="nginx"
INTERNAL_APPLICATION_HOST=$NAMESPACE.$INTERNAL_INGRESS_HOST
# TODO Enable this when ready
# EXTERNAL_APPLICATION_HOST=$NAMESPACE.$EXTERNAL_INGRESS_HOST
EXTERNAL_APPLICATION_HOST=$NAMESPACE.$INTERNAL_INGRESS_HOST
REPOSITORY="gateway-private.test.pdnd-interop.pagopa.it"
# TODO Update when test db is ready
# POSTGRES_HOST="pdnd-interop-dev-rds.c9zr6t2swdpb.eu-central-1.rds.amazonaws.com"
POSTGRES_HOST="postgres"
POSTGRES_PORT="5432"
REPLICAS=1


AGREEMENT_MANAGEMENT_INTERFACE_VERSION=$(shortVersion $AGREEMENT_MANAGEMENT_IMAGE_VERSION)
ATTRIBUTE_REGISTRY_MANAGEMENT_INTERFACE_VERSION=$(shortVersion $ATTRIBUTE_REGISTRY_MANAGEMENT_IMAGE_VERSION)
CATALOG_MANAGEMENT_INTERFACE_VERSION=$(shortVersion $CATALOG_MANAGEMENT_IMAGE_VERSION)
PARTY_MANAGEMENT_INTERFACE_VERSION=$(shortVersion $PARTY_MANAGEMENT_IMAGE_VERSION)
USER_REGISTRY_MANAGEMENT_INTERFACE_VERSION=$(shortVersion $USER_REGISTRY_MANAGEMENT_IMAGE_VERSION)

AGREEMENT_MANAGEMENT_SERVICE_NAME="pdnd-interop-uservice-agreement-management"
ATTRIBUTE_REGISTRY_MANAGEMENT_SERVICE_NAME="pdnd-interop-uservice-attribute-registry-management"
CATALOG_MANAGEMENT_SERVICE_NAME="pdnd-interop-uservice-catalog-management"
PARTY_MANAGEMENT_SERVICE_NAME="pdnd-interop-uservice-party-management"
USER_REGISTRY_MANAGEMENT_SERVICE_NAME="pdnd-interop-uservice-user-registry-management"

# Party Management
PARTY_MANAGEMENT_STORAGE_TYPE="something"
PARTY_MANAGEMENT_STORAGE_CONTAINER="something"
PARTY_MANAGEMENT_STORAGE_ENDPOINT="something"

USER_REGISTRY_MANAGEMENT_URL="https://$INTERNAL_APPLICATION_HOST/$USER_REGISTRY_MANAGEMENT_SERVICE_NAME/$USER_REGISTRY_MANAGEMENT_INTERFACE_VERSION"

# SPID
IDP_SERVICE_URL=$NAMESPACE-idp.$EXTERNAL_INGRESS_HOST
SPID_LOGIN_SERVICE_NAME="hub-spid-login-ms"
REDIS_SERVICE_NAME="redis"

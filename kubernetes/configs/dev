#!/bin/bash

# Functions
# TODO Take version from image label
function shortVersion() {
  echo $1 | grep -oE '[0-9]+\.[0-9]+'
}

# Services Versions
AGREEMENT_MANAGEMENT_IMAGE_VERSION="v0.1.1-snapshot"
ATTRIBUTE_REGISTRY_MANAGEMENT_IMAGE_VERSION="v0.1.1-snapshot"
AUTHORIZATION_MANAGEMENT_IMAGE_VERSION="v0.1.1-snapshot"
AUTHORIZATION_PROCESS_IMAGE_VERSION="v0.1.1-snapshot"
CATALOG_MANAGEMENT_IMAGE_VERSION="v0.1.1-snapshot"
CATALOG_PROCESS_IMAGE_VERSION="v0.1.1-snapshot"
ESERVICE_MOCKUP_IMAGE_VERSION="v0.1.1-snapshot"
KEY_MANAGEMENT_IMAGE_VERSION="v0.1.1-snapshot"
PARTY_MANAGEMENT_IMAGE_VERSION="v0.1.1-snapshot"
PARTY_MOCK_REGISTRY_IMAGE_VERSION="v0.1.1-snapshot"
PARTY_PROCESS_REVIEWS_IMAGE_VERSION="v0.1.1-snapshot"
PARTY_REGISTRY_PROXY_IMAGE_VERSION="v0.1.1-snapshot"
USER_REGISTRY_MANAGEMENT_IMAGE_VERSION="v0.1.1-snapshot"

SPID_LOGIN_MODULE_IMAGE_VERSION="2.1.2"

# Common
NAMESPACE=$NAMESPACE
INTERNAL_INGRESS_HOST="gateway.interop.pdnd.dev"
EXTERNAL_INGRESS_HOST="gateway.interop.pdnd.dev"
INTERNAL_INGRESS_CLASS="nginx"
EXTERNAL_INGRESS_CLASS="nginx"
INTERNAL_APPLICATION_HOST=$NAMESPACE.$INTERNAL_INGRESS_HOST
EXTERNAL_APPLICATION_HOST=$NAMESPACE.$EXTERNAL_INGRESS_HOST
REPOSITORY="gateway.interop.pdnd.dev"
POSTGRES_HOST="pdnd-interop-dev-rds.c9zr6t2swdpb.eu-central-1.rds.amazonaws.com"
POSTGRES_PORT="5432"
REPLICAS=1
WELL_KNOWN_URL="https://pdnd-interop-dev-public.s3.eu-central-1.amazonaws.com/.well-known/jwks.json"

AGREEMENT_MANAGEMENT_INTERFACE_VERSION=$(shortVersion $AGREEMENT_MANAGEMENT_IMAGE_VERSION)
ATTRIBUTE_REGISTRY_MANAGEMENT_INTERFACE_VERSION=$(shortVersion $ATTRIBUTE_REGISTRY_MANAGEMENT_IMAGE_VERSION)
CATALOG_MANAGEMENT_INTERFACE_VERSION=$(shortVersion $CATALOG_MANAGEMENT_IMAGE_VERSION)
PARTY_MANAGEMENT_INTERFACE_VERSION=$(shortVersion $PARTY_MANAGEMENT_IMAGE_VERSION)
USER_REGISTRY_MANAGEMENT_INTERFACE_VERSION=$(shortVersion $USER_REGISTRY_MANAGEMENT_IMAGE_VERSION)

AGREEMENT_MANAGEMENT_SERVICE_NAME="pdnd-interop-uservice-agreement-management"
ATTRIBUTE_REGISTRY_MANAGEMENT_SERVICE_NAME="pdnd-interop-uservice-attribute-registry-management"
CATALOG_MANAGEMENT_SERVICE_NAME="pdnd-interop-uservice-catalog-management"
PARTY_MANAGEMENT_SERVICE_NAME="pdnd-interop-uservice-party-management"
CATALOG_PROCESS_SERVICE_NAME="pdnd-interop-uservice-catalog-process"
USER_REGISTRY_MANAGEMENT_SERVICE_NAME="pdnd-interop-uservice-user-registry-management"

# Party Management
PARTY_MANAGEMENT_STORAGE_TYPE="S3"
PARTY_MANAGEMENT_STORAGE_CONTAINER="interop-pdnd-dev-support"
PARTY_MANAGEMENT_STORAGE_ENDPOINT=""

# Catalog Process
CATALOG_PROCESS_STORAGE_TYPE="S3"
CATALOG_PROCESS_STORAGE_CONTAINER="interop-pdnd-dev-support"
CATALOG_PROCESS_STORAGE_ENDPOINT=""


USER_REGISTRY_MANAGEMENT_URL="$USER_REGISTRY_MANAGEMENT_SERVICE_NAME/$USER_REGISTRY_MANAGEMENT_INTERFACE_VERSION"

# SPID
IDP_SERVICE_URL=$NAMESPACE-idp.$INTERNAL_INGRESS_HOST
SPID_LOGIN_SERVICE_NAME="hub-spid-login-ms"
REDIS_SERVICE_NAME="redis"
